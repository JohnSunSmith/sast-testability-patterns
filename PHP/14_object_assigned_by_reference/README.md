[//]: # (This file is automatically generated. If you wish to make any changes, please use the JSON files and regenerate this file using the tpframework.)

# Object Assigned By Reference

Tags: sast, php, php_v7.4.9

Version: v1.0

## Description

Instance variables can be assigned by reference, every change to a variable referencing an instance variable of an object will be reflected in the instance variable and vice versa.

## Overview

| Instances                 | has discovery rule   | discovery method   | rule successfull   |
|---------------------------|----------------------|--------------------|--------------------|
| [1 Instance](#1-instance) | yes                  | joern              | yes                |
| [2 Instance](#2-instance) | yes                  | joern              | yes                |
| [3 Instance](#3-instance) | yes                  | joern              | yes                |

<details markdown="1"open>
<summary>

## 1 Instance
</summary>

The instance shows a variable assigned to an instance variable of an object by reference. The instance variable is first assigned to the other variable and than the other variable is set to a user controlled input.

### Code

```PHP
<?php
class myclass {
    public $prop;
};
$x = "safe";
$obj = new myclass();
$obj->prop = &$x; // tarpit
$x = $_GET["p1"]; // source
echo $obj->prop; // sink
```

### Instance Properties

| category   | feature_vs_internal_api   | input_sanitizer   | negative_test_case   | source_and_sink   |
|------------|---------------------------|-------------------|----------------------|-------------------|
| S0         | FEATURE                   | no                | no                   | no                |

<details markdown="1">
<summary>
<b>More</b></summary>

<details markdown="1">
<summary>

### Compile
</summary>

```bash
$_main:
     ; (lines=12, args=0, vars=2, tmps=9)
     ; (before optimizer)
     ; /.../PHP/14_object_assigned_by_reference/1_instance_14_object_assigned_by_reference/1_instance_14_object_assigned_by_reference.php:1-9
     ; return  [] RANGE[0..0]
0000 ASSIGN CV0($x) string("safe")
0001 V3 = NEW 0 string("myclass")
0002 DO_FCALL
0003 ASSIGN CV1($obj) V3
0004 ASSIGN_OBJ_REF CV1($obj) string("prop")
0005 OP_DATA CV0($x)
0006 T7 = FETCH_R (global) string("_GET")
0007 T8 = FETCH_DIM_R T7 string("p1")
0008 ASSIGN CV0($x) T8
0009 T10 = FETCH_OBJ_R CV1($obj) string("prop")
0010 ECHO T10
0011 RETURN int(1)
LIVE RANGES:
     3: 0002 - 0003 (new)
```

</details>

<details markdown="1">
<summary>

### Discovery
</summary>

The rule searches for `ASSIGN_OBJ_REF` which is used to assign objects by reference. The rule is the same for all instances.

```scala
val x14 = (name, "14_object_assigned_by_reference_iall", cpg.call(".*ASSIGN_OBJ_REF.*").location.toJson);
```

| discovery method   | expected accuracy   |
|--------------------|---------------------|
| joern              | Perfect             |

</details>

<details markdown="1"open>
<summary>

### Measurement
</summary>

| Tool        | Comm_1   | Comm_2   | Ground Truth   |
|-------------|----------|----------|----------------|
| 17 May 2023 | yes      | no       | yes            |

</details>

</details>

</details>

<details markdown="1">
<summary>

## 2 Instance
</summary>

The instance shows a variable assigned to an instance variable of an object by reference. The other variable is first set to a user controlled input and than this variable is assigned to an instance variable of an object.

### Code

```PHP
<?php
class myclass {
    public $prop;
};
$x = "safe";
$obj = new myclass();
$x = $_GET["p1"]; // source
$obj->prop = &$x; // tarpit
echo $obj->prop; // sink
```

### Instance Properties

| category   | feature_vs_internal_api   | input_sanitizer   | negative_test_case   | source_and_sink   |
|------------|---------------------------|-------------------|----------------------|-------------------|
| S0         | FEATURE                   | no                | no                   | no                |

<details markdown="1">
<summary>
<b>More</b></summary>

<details markdown="1">
<summary>

### Compile
</summary>

```bash
$_main:
     ; (lines=12, args=0, vars=2, tmps=9)
     ; (before optimizer)
     ; /.../PHP/14_object_assigned_by_reference/2_instance_14_object_assigned_by_reference/2_instance_14_object_assigned_by_reference.php:1-9
     ; return  [] RANGE[0..0]
0000 ASSIGN CV0($x) string("safe")
0001 V3 = NEW 0 string("myclass")
0002 DO_FCALL
0003 ASSIGN CV1($obj) V3
0004 T6 = FETCH_R (global) string("_GET")
0005 T7 = FETCH_DIM_R T6 string("p1")
0006 ASSIGN CV0($x) T7
0007 ASSIGN_OBJ_REF CV1($obj) string("prop")
0008 OP_DATA CV0($x)
0009 T10 = FETCH_OBJ_R CV1($obj) string("prop")
0010 ECHO T10
0011 RETURN int(1)
LIVE RANGES:
     3: 0002 - 0003 (new)
```

</details>

<details markdown="1">
<summary>

### Discovery
</summary>

The rule searches for `ASSIGN_OBJ_REF` which is used to assign objects by reference. The rule is the same for all instances.

```scala
val x14 = (name, "14_object_assigned_by_reference_iall", cpg.call(".*ASSIGN_OBJ_REF.*").location.toJson);
```

| discovery method   | expected accuracy   |
|--------------------|---------------------|
| joern              | Perfect             |

</details>

<details markdown="1"open>
<summary>

### Measurement
</summary>

| Tool        | Comm_1   | Comm_2   | Ground Truth   |
|-------------|----------|----------|----------------|
| 17 May 2023 | yes      | yes      | yes            |

</details>

</details>

</details>

<details markdown="1">
<summary>

## 3 Instance
</summary>

This instance provides another indirection through which the user input reaches the sink. In this instance, it is stored in an intermediate variable, which is assigned to another variable, which itself links to the instance variable, that is used for the output.

### Code

```PHP
<?php
class myclass {
    public $prop;
};
$a = $_GET["p1"]; // source
$x = "safe";
$obj = new myclass();
$obj->prop = &$x; // tarpit
$x = $a;
echo $obj->prop; // sink
```

### Instance Properties

| category   | feature_vs_internal_api   | input_sanitizer   | negative_test_case   | source_and_sink   |
|------------|---------------------------|-------------------|----------------------|-------------------|
| S0         | FEATURE                   | no                | no                   | no                |

<details markdown="1">
<summary>
<b>More</b></summary>

<details markdown="1">
<summary>

### Compile
</summary>

```bash
$_main:
     ; (lines=13, args=0, vars=3, tmps=10)
     ; (before optimizer)
     ; /.../PHP/14_object_assigned_by_reference/3_instance_14_object_assigned_by_reference/3_instance_14_object_assigned_by_reference.php:1-10
     ; return  [] RANGE[0..0]
0000 T3 = FETCH_R (global) string("_GET")
0001 T4 = FETCH_DIM_R T3 string("p1")
0002 ASSIGN CV0($a) T4
0003 ASSIGN CV1($x) string("safe")
0004 V7 = NEW 0 string("myclass")
0005 DO_FCALL
0006 ASSIGN CV2($obj) V7
0007 ASSIGN_OBJ_REF CV2($obj) string("prop")
0008 OP_DATA CV1($x)
0009 ASSIGN CV1($x) CV0($a)
0010 T12 = FETCH_OBJ_R CV2($obj) string("prop")
0011 ECHO T12
0012 RETURN int(1)
LIVE RANGES:
     7: 0005 - 0006 (new)
```

</details>

<details markdown="1">
<summary>

### Discovery
</summary>

The rule searches for `ASSIGN_OBJ_REF` which is used to assign objects by reference. The rule is the same for all instances.

```scala
val x14 = (name, "14_object_assigned_by_reference_iall", cpg.call(".*ASSIGN_OBJ_REF.*").location.toJson);
```

| discovery method   | expected accuracy   |
|--------------------|---------------------|
| joern              | Perfect             |

</details>

<details markdown="1"open>
<summary>

### Measurement
</summary>

| Tool        | Comm_1   | Comm_2   | Ground Truth   |
|-------------|----------|----------|----------------|
| 17 May 2023 | yes      | no       | yes            |

</details>

</details>

</details>
