[//]: # (This file is automatically generated. If you wish to make any changes, please use the JSON files and regenerate this file using the tpframework.)

# Variadic Functions

Tags: sast, php, php_v7.4.9

Version: v1.0

## Description

Variadic functions in PHP allow a function to accept an arbitrary number of arguments, which are automatically collected into an array, using the ... (ellipsis) operator.

## Overview

| Instances                 | has discovery rule   | discovery method   | rule successfull   |
|---------------------------|----------------------|--------------------|--------------------|
| [1 Instance](#1-instance) | yes                  | joern              | yes                |
| [2 Instance](#2-instance) | yes                  | joern              | yes                |
| [3 Instance](#3-instance) | yes                  | joern              | yes                |

<details markdown="1"open>
<summary>

## 1 Instance
</summary>

This instance shows a function, that takes an arbitrary number of variables and outputs each of them. The sink is within the function.

### Code

```PHP
<?php
// $numbers: list of parameters 
function sum(...$numbers) {
    foreach ($numbers as $n) {
        // XSS when it will print the last element $b
        echo $n; // sink
    }
}

$a = $_GET["p1"]; // source
sum(1, 2, 3, $a); // tarpit
```

### Instance Properties

| category   | feature_vs_internal_api   | input_sanitizer   | negative_test_case   | source_and_sink   |
|------------|---------------------------|-------------------|----------------------|-------------------|
| S0         | FEATURE                   | no                | no                   | no                |

<details markdown="1">
<summary>
<b>More</b></summary>

<details markdown="1">
<summary>

### Compile
</summary>

```bash
$_main:
     ; (lines=10, args=0, vars=1, tmps=4)
     ; (before optimizer)
     ; /.../PHP/16_variadic_functions/1_instance_16_variadic_functions/1_instance_16_variadic_functions.php:1-11
     ; return  [] RANGE[0..0]
0000 T1 = FETCH_R (global) string("_GET")
0001 T2 = FETCH_DIM_R T1 string("p1")
0002 ASSIGN CV0($a) T2
0003 INIT_FCALL 4 192 string("sum")
0004 SEND_VAL int(1) 1
0005 SEND_VAL int(2) 2
0006 SEND_VAL int(3) 3
0007 SEND_VAR CV0($a) 4
0008 DO_UCALL
0009 RETURN int(1)

sum:
     ; (lines=7, args=0, vars=2, tmps=1)
     ; (before optimizer)
     ; /.../PHP/16_variadic_functions/1_instance_16_variadic_functions/1_instance_16_variadic_functions.php:3-8
     ; return  [] RANGE[0..0]
0000 CV0($numbers) = RECV_VARIADIC 1
0001 V2 = FE_RESET_R CV0($numbers) 0005
0002 FE_FETCH_R V2 CV1($n) 0005
0003 ECHO CV1($n)
0004 JMP 0002
0005 FE_FREE V2
0006 RETURN null
LIVE RANGES:
     2: 0002 - 0005 (loop)
```

</details>

<details markdown="1">
<summary>

### Discovery
</summary>

The rule searches for `RECV_VARIADIC`.

```scala
val x16 = (name, "16_variadic_functions_iall", cpg.call(".*RECV_VARIADIC.*").location.toJson);
```

| discovery method   | expected accuracy   |
|--------------------|---------------------|
| joern              | Perfect             |

</details>

<details markdown="1"open>
<summary>

### Measurement
</summary>

| Tool        | Comm_1   | Comm_2   | phpSAFE   | Progpilot   | RIPS   | WAP   | Ground Truth   |
|-------------|----------|----------|-----------|-------------|--------|-------|----------------|
| 08 Jun 2021 | yes      | yes      | no        | no          | no     | no    | yes            |
| 17 May 2023 | yes      | yes      |           |             |        |       | yes            |

</details>

</details>

</details>

<details markdown="1">
<summary>

## 2 Instance
</summary>

The instance shows a function, that takes an arbitrary number of arguments and returns the fourth, which contains a user controlled value.

### Code

```PHP
<?php
// $numbers: list of parameters 
function sum(...$numbers) { // tarpit
    return $numbers[3];
}
$a = $_GET["p1"]; // source
$b = sum(1, 2, 3, $a); // XSS when the last element $a is returned
echo $b; // sink
```

### Instance Properties

| category   | feature_vs_internal_api   | input_sanitizer   | negative_test_case   | source_and_sink   |
|------------|---------------------------|-------------------|----------------------|-------------------|
| S0         | FEATURE                   | no                | no                   | no                |

<details markdown="1">
<summary>
<b>More</b></summary>

<details markdown="1">
<summary>

### Compile
</summary>

```bash
$_main:
     ; (lines=12, args=0, vars=2, tmps=5)
     ; (before optimizer)
     ; /.../PHP/16_variadic_functions/2_instance_16_variadic_functions/2_instance_16_variadic_functions.php:1-8
     ; return  [] RANGE[0..0]
0000 T2 = FETCH_R (global) string("_GET")
0001 T3 = FETCH_DIM_R T2 string("p1")
0002 ASSIGN CV0($a) T3
0003 INIT_FCALL 4 176 string("sum")
0004 SEND_VAL int(1) 1
0005 SEND_VAL int(2) 2
0006 SEND_VAL int(3) 3
0007 SEND_VAR CV0($a) 4
0008 V5 = DO_UCALL
0009 ASSIGN CV1($b) V5
0010 ECHO CV1($b)
0011 RETURN int(1)

sum:
     ; (lines=4, args=0, vars=1, tmps=1)
     ; (before optimizer)
     ; /.../PHP/16_variadic_functions/2_instance_16_variadic_functions/2_instance_16_variadic_functions.php:3-5
     ; return  [] RANGE[0..0]
0000 CV0($numbers) = RECV_VARIADIC 1
0001 T1 = FETCH_DIM_R CV0($numbers) int(3)
0002 RETURN T1
0003 RETURN null
```

</details>

<details markdown="1">
<summary>

### Discovery
</summary>

The rule searches for `RECV_VARIADIC`.

```scala
val x16 = (name, "16_variadic_functions_iall", cpg.call(".*RECV_VARIADIC.*").location.toJson);
```

| discovery method   | expected accuracy   |
|--------------------|---------------------|
| joern              | Perfect             |

</details>

<details markdown="1"open>
<summary>

### Measurement
</summary>

| Tool        | Comm_1   | Comm_2   | Ground Truth   |
|-------------|----------|----------|----------------|
| 17 May 2023 | yes      | yes      | yes            |

</details>

</details>

</details>

<details markdown="1">
<summary>

## 3 Instance
</summary>

The instance shows a function, that takes an arbitrary number of arguments and returns the first argument, that is not 1, so if the user controlled value is something different than 1, it ends up in the sink.

### Code

```PHP
<?php
// $numbers: list of parameters 
function sum(...$numbers) {
    foreach ($numbers as $n) {
            if ($n != 1) {
            	return $n;
            };
        };
    return "safe";
};

$a = $_GET["p1"]; // source
$b = sum(1, 1, 1, $a); // tarpit
echo $b; // sink
```

### Instance Properties

| category   | feature_vs_internal_api   | input_sanitizer   | negative_test_case   | source_and_sink   |
|------------|---------------------------|-------------------|----------------------|-------------------|
| S0         | FEATURE                   | no                | no                   | no                |

<details markdown="1">
<summary>
<b>More</b></summary>

<details markdown="1">
<summary>

### Compile
</summary>

```bash
$_main:
     ; (lines=12, args=0, vars=2, tmps=5)
     ; (before optimizer)
     ; /.../PHP/16_variadic_functions/3_instance_16_variadic_functions/3_instance_16_variadic_functions.php:1-14
     ; return  [] RANGE[0..0]
0000 T2 = FETCH_R (global) string("_GET")
0001 T3 = FETCH_DIM_R T2 string("p1")
0002 ASSIGN CV0($a) T3
0003 INIT_FCALL 4 208 string("sum")
0004 SEND_VAL int(1) 1
0005 SEND_VAL int(1) 2
0006 SEND_VAL int(1) 3
0007 SEND_VAR CV0($a) 4
0008 V5 = DO_UCALL
0009 ASSIGN CV1($b) V5
0010 ECHO CV1($b)
0011 RETURN int(1)

sum:
     ; (lines=11, args=0, vars=2, tmps=2)
     ; (before optimizer)
     ; /.../PHP/16_variadic_functions/3_instance_16_variadic_functions/3_instance_16_variadic_functions.php:3-10
     ; return  [] RANGE[0..0]
0000 CV0($numbers) = RECV_VARIADIC 1
0001 V2 = FE_RESET_R CV0($numbers) 0008
0002 FE_FETCH_R V2 CV1($n) 0008
0003 T3 = IS_NOT_EQUAL CV1($n) int(1)
0004 JMPZ T3 0007
0005 FE_FREE V2
0006 RETURN CV1($n)
0007 JMP 0002
0008 FE_FREE V2
0009 RETURN string("safe")
0010 RETURN null
LIVE RANGES:
     2: 0002 - 0008 (loop)
```

</details>

<details markdown="1">
<summary>

### Discovery
</summary>

The rule searches for `RECV_VARIADIC`.

```scala
val x16 = (name, "16_variadic_functions_iall", cpg.call(".*RECV_VARIADIC.*").location.toJson);
```

| discovery method   | expected accuracy   |
|--------------------|---------------------|
| joern              | Perfect             |

</details>

<details markdown="1"open>
<summary>

### Measurement
</summary>

| Tool        | Comm_1   | Comm_2   | Ground Truth   |
|-------------|----------|----------|----------------|
| 17 May 2023 | yes      | yes      | yes            |

</details>

</details>

</details>
