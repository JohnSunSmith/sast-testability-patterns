[//]: # (This file is automatically generated. If you wish to make any changes, please use the JSON files and regenerate this file using the tpframework.)

# Get Arguments

Tags: sast, php, php_v7.4.9

Version: v1.0

## Description

In PHP it is not possible to define more than one function with the same name, even if the number of arguments are different between the two functions.

```php
<?php
function F($x) {
    echo $x;
}
function F($x,$y ) {
    echo $x;
    echo $y;
}
F(2,3);// FATAL ERROR: CANNOT RE-DECLARE F
```

In addition to that, It is possible to send arguments to a function more than what it will be received. 
Then the function [func_get_args](https://www.php.net/manual/en/function.func-get-args.php) will return an array with the rest of the arguments. 
In PHP7 there is [Variadic](https://www.phptutorial.net/php-tutorial/php-variadic-functions/) which begin to be used instead of the function func_get_args.

```php
<?php
function F($x) {
    echo $x; // 3
    var_dump(func_get_args()); // 5, 7 , 11
}
F(3,5,7,11);
```

The problem when the scanners are not processing the received arguments with this function.
The scanners can solve this pattern, there is no difficulty to receive the array of the arguments from the function. 
The problem that this feature is only in PHP and it is missed with many of the testing tools.

## Overview

| Instances                 | has discovery rule   | discovery method   | rule successfull   |
|---------------------------|----------------------|--------------------|--------------------|
| [1 Instance](#1-instance) | yes                  | joern              | yes                |
| [2 Instance](#2-instance) | yes                  | joern              | yes                |

<details markdown="1"open>
<summary>

## 1 Instance
</summary>

This instance uses `func_get_args` and iterates over all the arguments passed to the function and outputs those. The sink is within this for loop.

### Code

```PHP
<?php
function sum() {
    // it will print all the parameters
    // XSS vulnerability with the last element $b
    foreach (func_get_args() as $n) {
        echo $n; // sink
    }
}

$b = $_GET["p1"]; // source
sum(1, 2, 3, $b); // tarpit
```

### Instance Properties

| category   | feature_vs_internal_api   | input_sanitizer   | negative_test_case   | source_and_sink   |
|------------|---------------------------|-------------------|----------------------|-------------------|
| S0         | FEATURE                   | no                | no                   | no                |

<details markdown="1">
<summary>
<b>More</b></summary>

<details markdown="1">
<summary>

### Compile
</summary>

```bash
$_main:
     ; (lines=10, args=0, vars=1, tmps=4)
     ; (before optimizer)
     ; /.../PHP/17_get_arguments/1_instance_17_get_arguments/1_instance_17_get_arguments.php:1-11
     ; return  [] RANGE[0..0]
0000 T1 = FETCH_R (global) string("_GET")
0001 T2 = FETCH_DIM_R T1 string("p1")
0002 ASSIGN CV0($b) T2
0003 INIT_FCALL 4 192 string("sum")
0004 SEND_VAL int(1) 1
0005 SEND_VAL int(2) 2
0006 SEND_VAL int(3) 3
0007 SEND_VAR CV0($b) 4
0008 DO_UCALL
0009 RETURN int(1)

sum:
     ; (lines=7, args=0, vars=1, tmps=2)
     ; (before optimizer)
     ; /.../PHP/17_get_arguments/1_instance_17_get_arguments/1_instance_17_get_arguments.php:2-8
     ; return  [] RANGE[0..0]
0000 T1 = FUNC_GET_ARGS
0001 V2 = FE_RESET_R T1 0005
0002 FE_FETCH_R V2 CV0($n) 0005
0003 ECHO CV0($n)
0004 JMP 0002
0005 FE_FREE V2
0006 RETURN null
LIVE RANGES:
     2: 0002 - 0005 (loop)
```

</details>

<details markdown="1">
<summary>

### Discovery
</summary>

In opcode there is a special opcode for this function `FUNC_GET_ARGS`.

```scala
val x17 = (name, "17_get_arguments_iall", cpg.call(".*FUNC_GET_ARGS.*").location.toJson);
```

| discovery method   | expected accuracy   |
|--------------------|---------------------|
| joern              | Perfect             |

</details>

<details markdown="1"open>
<summary>

### Measurement
</summary>

| Tool        | Comm_1   | Comm_2   | phpSAFE   | Progpilot   | RIPS   | WAP   | Ground Truth   |
|-------------|----------|----------|-----------|-------------|--------|-------|----------------|
| 08 Jun 2021 | no       | yes      | no        | no          | yes    | no    | yes            |
| 17 May 2023 | no       | yes      |           |             |        |       | yes            |

</details>

</details>

</details>

<details markdown="1">
<summary>

## 2 Instance
</summary>

This instance uses `func_get_args` to output the fourth element, which contains user controlled input.

### Code

```PHP
<?php
function fourth() { // fourth element returned
    return func_get_args()[3]; //tarpit
}
$a = $_GET["p1"]; // source
$b = fourth(1, 2, 3, $a);
echo $b; // sink
```

### Instance Properties

| category   | feature_vs_internal_api   | input_sanitizer   | negative_test_case   | source_and_sink   |
|------------|---------------------------|-------------------|----------------------|-------------------|
| S0         | FEATURE                   | no                | no                   | no                |

<details markdown="1">
<summary>
<b>More</b></summary>

<details markdown="1">
<summary>

### Compile
</summary>

```bash
$_main:
     ; (lines=12, args=0, vars=2, tmps=5)
     ; (before optimizer)
     ; /.../PHP/17_get_arguments/2_instance_17_get_arguments/2_instance_17_get_arguments.php:1-7
     ; return  [] RANGE[0..0]
0000 T2 = FETCH_R (global) string("_GET")
0001 T3 = FETCH_DIM_R T2 string("p1")
0002 ASSIGN CV0($a) T3
0003 INIT_FCALL 4 176 string("fourth")
0004 SEND_VAL int(1) 1
0005 SEND_VAL int(2) 2
0006 SEND_VAL int(3) 3
0007 SEND_VAR CV0($a) 4
0008 V5 = DO_UCALL
0009 ASSIGN CV1($b) V5
0010 ECHO CV1($b)
0011 RETURN int(1)

fourth:
     ; (lines=4, args=0, vars=0, tmps=2)
     ; (before optimizer)
     ; /.../PHP/17_get_arguments/2_instance_17_get_arguments/2_instance_17_get_arguments.php:2-4
     ; return  [] RANGE[0..0]
0000 T0 = FUNC_GET_ARGS
0001 T1 = FETCH_DIM_R T0 int(3)
0002 RETURN T1
0003 RETURN null
```

</details>

<details markdown="1">
<summary>

### Discovery
</summary>

In opcode there is a special opcode for this function `FUNC_GET_ARGS`.

```scala
val x17 = (name, "17_get_arguments_iall", cpg.call(".*FUNC_GET_ARGS.*").location.toJson);
```

| discovery method   | expected accuracy   |
|--------------------|---------------------|
| joern              | Perfect             |

</details>

<details markdown="1"open>
<summary>

### Measurement
</summary>

| Tool        | Comm_1   | Comm_2   | Ground Truth   |
|-------------|----------|----------|----------------|
| 17 May 2023 | no       | yes      | yes            |

</details>

</details>

</details>
