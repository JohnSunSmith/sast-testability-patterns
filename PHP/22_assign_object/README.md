[//]: # (This file is automatically generated. If you wish to make any changes, please use the JSON files and regenerate this file using the tpframework.)

# Assign Object

Tags: sast, php, php_v7.4.9

Version: v1.0

## Description

Object assignment in PHP creates a reference to the same object in memory, rather than a new copy, which means that any changes made to the object through one variable or function parameter will be reflected in all other variables or parameters that reference the same object.

## Overview

| Instances                 | has discovery rule   | discovery method   | rule successfull   |
|---------------------------|----------------------|--------------------|--------------------|
| [1 Instance](#1-instance) | yes                  | joern              | yes                |

## 1 Instance

This instance shows, then when assigning one object to another object, they both point to the same object in memory, so they have the same attributes.

### Code

```PHP
<?php
class myclass {
   public $b = "safe";
}
$obj1 = new myclass();
$obj1->b = "safe2";
$obj2 = $obj1;
$obj2->b = $_GET["p1"]; // source
// XSS vulnerability
echo $obj1->b; // sink
```

### Instance Properties

| category   | feature_vs_internal_api   | input_sanitizer   | negative_test_case   | source_and_sink   |
|------------|---------------------------|-------------------|----------------------|-------------------|
| S0         | FEATURE                   | no                | no                   | no                |

<details markdown="1">
<summary>
<b>More</b></summary>

<details markdown="1">
<summary>

### Compile
</summary>

```bash
$_main:
     ; (lines=13, args=0, vars=2, tmps=9)
     ; (before optimizer)
     ; /.../PHP/22_assign_object/1_instance_22_assign_object/1_instance_22_assign_object.php:1-10
     ; return  [] RANGE[0..0]
0000 V2 = NEW 0 string("myclass")
0001 DO_FCALL
0002 ASSIGN CV0($obj1) V2
0003 ASSIGN_OBJ CV0($obj1) string("b")
0004 OP_DATA string("safe2")
0005 ASSIGN CV1($obj2) CV0($obj1)
0006 T8 = FETCH_R (global) string("_GET")
0007 T9 = FETCH_DIM_R T8 string("p1")
0008 ASSIGN_OBJ CV1($obj2) string("b")
0009 OP_DATA T9
0010 T10 = FETCH_OBJ_R CV0($obj1) string("b")
0011 ECHO T10
0012 RETURN int(1)
LIVE RANGES:
     2: 0001 - 0002 (new)
```

</details>

<details markdown="1">
<summary>

### Discovery
</summary>

This rules first collects all `ASSIGN` calls, which are reachable by a `NEW` call in `G1`. 
In `R1` it collects all `ASSIGN` calls where one variable is assigned to another variable in a list.
Finally, the rule filters out all `ASSIGN` calls from `R1`, where any call from `G1` is invoked in.

```scala
val G1 = cpg.call("ASSIGN").reachableByFlows(cpg.call.code(".*NEW.*")).map(_.elements.last).collect{ case c : nodes.Call => c}.argument.order(0).isIdentifier.name.l.distinct
val R1 = cpg.call("ASSIGN").code(".*CV.*CV.*").l
val x22 = (name, "22_assign_object_iall", R1.filter{ call => G1.exists{ h => call.argument.order(1).code.l.contains("CV($" + h + ")")} }.location.toJson);
```

| discovery method   | expected accuracy   |
|--------------------|---------------------|
| joern              | Perfect             |

</details>

<details markdown="1"open>
<summary>

### Measurement
</summary>

| Tool        | Comm_1   | Comm_2   | phpSAFE   | Progpilot   | RIPS   | WAP   | Ground Truth   |
|-------------|----------|----------|-----------|-------------|--------|-------|----------------|
| 08 Jun 2021 | yes      | no       | no        | no          | no     | yes   | yes            |
| 17 May 2023 | yes      | no       |           |             |        |       | yes            |

</details>

</details>
