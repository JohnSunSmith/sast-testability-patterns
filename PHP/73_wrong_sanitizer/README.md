[//]: # (This file is automatically generated. If you wish to make any changes, please use the JSON files and regenerate this file using the tpframework.)

# Wrong Sanitizer

Tags: sast, php, php_v7.4.9

Version: v1.0

## Description

When dealing with data from untrusted sources,it is always useful to sanitize the data before processing it. PHP offers multiple options to sanitize input strings. This pattern targets some wrong sanitizing functions.

## Overview

| Instances                 | has discovery rule   | discovery method   | rule successfull   |
|---------------------------|----------------------|--------------------|--------------------|
| [1 Instance](#1-instance) | yes                  | joern              | yes                |
| [2 Instance](#2-instance) | yes                  | joern              | yes                |

<details markdown="1"open>
<summary>

## 1 Instance
</summary>

The instance uses `strip_tags` on the input.

### Code

```PHP
<?php
$x = $_GET["p"]; // source
// " onfocus="alert(1)" autofocus="
// https://security.stackexchange.com/questions/97550/how-to-launch-xss-code-from-an-input-html-tag-upon-page-load
$y = strip_tags($x);
?>

<input type="hidden" name="return" value="<?php echo $y ?>" /> // sink
```

### Instance Properties

| category   | feature_vs_internal_api   | input_sanitizer   | negative_test_case   | source_and_sink   |
|------------|---------------------------|-------------------|----------------------|-------------------|
| S0         | INTERNAL_API              | yes               | no                   | no                |

<details markdown="1">
<summary>
<b>More</b></summary>

<details markdown="1">
<summary>

### Compile
</summary>

```bash
$_main:
     ; (lines=11, args=0, vars=2, tmps=5)
     ; (before optimizer)
     ; /.../PHP/73_wrong_sanitizer/1_instance_73_wrong_sanitizer/1_instance_73_wrong_sanitizer.php:1-8
     ; return  [] RANGE[0..0]
0000 T2 = FETCH_R (global) string("_GET")
0001 T3 = FETCH_DIM_R T2 string("p")
0002 ASSIGN CV0($x) T3
0003 INIT_FCALL 1 96 string("strip_tags")
0004 SEND_VAR CV0($x) 1
0005 V5 = DO_ICALL
0006 ASSIGN CV1($y) V5
0007 ECHO string("
<input type="hidden" name="return" value="")
0008 ECHO CV1($y)
0009 ECHO string("" /> // sink")
0010 RETURN int(1)
```

</details>

<details markdown="1">
<summary>

### Discovery
</summary>

The discovery rule searches for function calls to `strip_tags` or `json_encode` on opcode level.

```scala
val x73 = (name, "73_wrong_sanitizers_iall", cpg.call(".*INIT_FCALL.*").argument.order(2).code("strip_tags|json_encode").astParent.location.toJson);
```

| discovery method   | expected accuracy   |
|--------------------|---------------------|
| joern              | Perfect             |

</details>

<details markdown="1"open>
<summary>

### Measurement
</summary>

| Tool        | Comm_1   | Comm_2   | phpSAFE   | Progpilot   | RIPS   | WAP   | Ground Truth   |
|-------------|----------|----------|-----------|-------------|--------|-------|----------------|
| 08 Jun 2021 | yes      | yes      | yes       | yes         | yes    | no    | yes            |
| 22 May 2023 | yes      | yes      |           |             |        |       | yes            |

</details>

</details>

</details>

<details markdown="1">
<summary>

## 2 Instance
</summary>

The instance uses `json_encode` on the input.

### Code

```PHP
<?php
$b = $_GET["p1"]; // source
$a = json_encode($b);
echo $a; // sink
```

### Instance Properties

| category   | feature_vs_internal_api   | input_sanitizer   | negative_test_case   | source_and_sink   |
|------------|---------------------------|-------------------|----------------------|-------------------|
| S0         | INTERNAL_API              | yes               | no                   | no                |

<details markdown="1">
<summary>
<b>More</b></summary>

<details markdown="1">
<summary>

### Compile
</summary>

```bash
$_main:
     ; (lines=9, args=0, vars=2, tmps=5)
     ; (before optimizer)
     ; /.../PHP/73_wrong_sanitizer/2_instance_73_wrong_sanitizer/2_instance_73_wrong_sanitizer.php:1-4
     ; return  [] RANGE[0..0]
0000 T2 = FETCH_R (global) string("_GET")
0001 T3 = FETCH_DIM_R T2 string("p1")
0002 ASSIGN CV0($b) T3
0003 INIT_FCALL 1 96 string("json_encode")
0004 SEND_VAR CV0($b) 1
0005 V5 = DO_ICALL
0006 ASSIGN CV1($a) V5
0007 ECHO CV1($a)
0008 RETURN int(1)
```

</details>

<details markdown="1">
<summary>

### Discovery
</summary>

The discovery rule searches for function calls to `strip_tags` or `json_encode` on opcode level.

```scala
val x73 = (name, "73_wrong_sanitizers_iall", cpg.call(".*INIT_FCALL.*").argument.order(2).code("strip_tags|json_encode").astParent.location.toJson);
```

| discovery method   | expected accuracy   |
|--------------------|---------------------|
| joern              | Perfect             |

</details>

<details markdown="1"open>
<summary>

### Measurement
</summary>

| Tool        | Comm_1   | Comm_2   | phpSAFE   | Progpilot   | RIPS   | WAP   | Ground Truth   |
|-------------|----------|----------|-----------|-------------|--------|-------|----------------|
| 08 Jun 2021 | yes      | no       | yes       | yes         | yes    | yes   | yes            |
| 22 May 2023 | yes      | no       |           |             |        |       | yes            |

</details>

</details>

</details>
