[//]: # (This file is automatically generated. If you wish to make any changes, please use the JSON files and regenerate this file using the tpframework.)

# New From Variable

Tags: sast, php, php_v7.4.9

Version: v1.0

## Description

The name for the class an object can be instantiated from, can be stored in a variable as for example string.

## Overview

| Instances                 | has discovery rule   | discovery method   | rule successfull   |
|---------------------------|----------------------|--------------------|--------------------|
| [1 Instance](#1-instance) | yes                  | joern              | yes                |
| [2 Instance](#2-instance) | yes                  | joern              | yes                |
| [3 Instance](#3-instance) | yes                  | joern              | yes                |

<details markdown="1"open>
<summary>

## 1 Instance
</summary>

The instance calls `new` on a variable, that is set to a string.

### Code

```PHP
<?php
class class1 {
   public $x;
   public function __construct($y) {
      $this->x = $y;
   }
}

$b = $_GET["p1"]; // source
$t = "class1";
$obj = new $t($b);
echo $obj->x; // sink
```

### Instance Properties

| category   | feature_vs_internal_api   | input_sanitizer   | negative_test_case   | source_and_sink   |
|------------|---------------------------|-------------------|----------------------|-------------------|
| D2         | FEATURE                   | no                | no                   | no                |

<details markdown="1">
<summary>
<b>More</b></summary>

<details markdown="1">
<summary>

### Compile
</summary>

```bash
$_main:
     ; (lines=12, args=0, vars=3, tmps=9)
     ; (before optimizer)
     ; /.../PHP/81_new_from_variable/1_instance_81_new_from_variable/1_instance_81_new_from_variable.php:1-12
     ; return  [] RANGE[0..0]
0000 T3 = FETCH_R (global) string("_GET")
0001 T4 = FETCH_DIM_R T3 string("p1")
0002 ASSIGN CV0($b) T4
0003 ASSIGN CV1($t) string("class1")
0004 V7 = FETCH_CLASS (exception) CV1($t)
0005 V8 = NEW 1 V7
0006 SEND_VAR_EX CV0($b) 1
0007 DO_FCALL
0008 ASSIGN CV2($obj) V8
0009 T11 = FETCH_OBJ_R CV2($obj) string("x")
0010 ECHO T11
0011 RETURN int(1)
LIVE RANGES:
     8: 0006 - 0008 (new)

class1::__construct:
     ; (lines=4, args=1, vars=1, tmps=1)
     ; (before optimizer)
     ; /.../PHP/81_new_from_variable/1_instance_81_new_from_variable/1_instance_81_new_from_variable.php:4-6
     ; return  [] RANGE[0..0]
0000 CV0($y) = RECV 1
0001 ASSIGN_OBJ THIS string("x")
0002 OP_DATA CV0($y)
0003 RETURN null
```

</details>

<details markdown="1">
<summary>

### Discovery
</summary>

```scala
def G3 = cpg.call("ASSIGN").code(".*string.*").argument.order(0).isIdentifier.name.l.distinct
def R4 = cpg.call("FETCH_CLASS").code(".*CV.*").l
val x81 = (name, "81_new_from_variable_i1", R4.filter{ call => G3.exists{ h => call.argument.order(1).code.l.contains("CV($" + h + ")")} }.location.toJson);
```

| discovery method   | expected accuracy   |
|--------------------|---------------------|
| joern              | Perfect             |

</details>

<details markdown="1"open>
<summary>

### Measurement
</summary>

| Tool        | Comm_1   | Comm_2   | phpSAFE   | Progpilot   | RIPS   | WAP   | Ground Truth   |
|-------------|----------|----------|-----------|-------------|--------|-------|----------------|
| 08 Jun 2021 | no       | no       | no        | no          | no     | no    | yes            |
| 22 May 2023 | no       | yes      |           |             |        |       | yes            |

</details>

</details>

</details>

<details markdown="1">
<summary>

## 2 Instance
</summary>

The instance calls `new` on a variable, where the variable is set by the user.

### Code

```PHP
<?php
class class1 {
   public $x;
   public function __construct($y) {
      $this->x = $y;
   }
}

$b = $_GET["p1"]; // source
$t = $_GET["p2"];
$obj = new $t($b);
echo $obj->x; // sink
```

### Instance Properties

| category   | feature_vs_internal_api   | input_sanitizer   | negative_test_case   | source_and_sink   |
|------------|---------------------------|-------------------|----------------------|-------------------|
| D4         | FEATURE                   | no                | no                   | no                |

<details markdown="1">
<summary>
<b>More</b></summary>

<details markdown="1">
<summary>

### Compile
</summary>

```bash
$_main:
     ; (lines=14, args=0, vars=3, tmps=11)
     ; (before optimizer)
     ; /.../PHP/81_new_from_variable/2_instance_81_new_from_variable/2_instance_81_new_from_variable.php:1-12
     ; return  [] RANGE[0..0]
0000 T3 = FETCH_R (global) string("_GET")
0001 T4 = FETCH_DIM_R T3 string("p1")
0002 ASSIGN CV0($b) T4
0003 T6 = FETCH_R (global) string("_GET")
0004 T7 = FETCH_DIM_R T6 string("p2")
0005 ASSIGN CV1($t) T7
0006 V9 = FETCH_CLASS (exception) CV1($t)
0007 V10 = NEW 1 V9
0008 SEND_VAR_EX CV0($b) 1
0009 DO_FCALL
0010 ASSIGN CV2($obj) V10
0011 T13 = FETCH_OBJ_R CV2($obj) string("x")
0012 ECHO T13
0013 RETURN int(1)
LIVE RANGES:
     10: 0008 - 0010 (new)

class1::__construct:
     ; (lines=4, args=1, vars=1, tmps=1)
     ; (before optimizer)
     ; /.../PHP/81_new_from_variable/2_instance_81_new_from_variable/2_instance_81_new_from_variable.php:4-6
     ; return  [] RANGE[0..0]
0000 CV0($y) = RECV 1
0001 ASSIGN_OBJ THIS string("x")
0002 OP_DATA CV0($y)
0003 RETURN null
```

</details>

<details markdown="1">
<summary>

### Discovery
</summary>

```scala
val x81 = (name, "81_new_from_variable_i2", cpg.call(".*NEW.*").argument.order(1).code("CV.*|T.*|V.*").location.toJson);
```

| discovery method   | expected accuracy   |
|--------------------|---------------------|
| joern              | FP                  |

</details>

<details markdown="1"open>
<summary>

### Measurement
</summary>

| Tool        | Comm_1   | Comm_2   | phpSAFE   | Progpilot   | RIPS   | WAP   | Ground Truth   |
|-------------|----------|----------|-----------|-------------|--------|-------|----------------|
| 08 Jun 2021 | no       | no       | no        | no          | no     | no    | yes            |
| 22 May 2023 | no       | yes      |           |             |        |       | yes            |

</details>

</details>

</details>

<details markdown="1">
<summary>

## 3 Instance
</summary>

This instance calls `new` on a variable, that uses the prefix 'class' and concatenates this with a user defined input.

### Code

```PHP
<?php
class class1 {
   public $x;
   public function __construct($y) {
      $this->x = $y;
   }
}

$b = $_GET["p1"]; // source
$bb = $_GET["p2"];
$t = "class".$bb;
$obj = new $t($b);
echo $obj->x; // sink
```

### Instance Properties

| category   | feature_vs_internal_api   | input_sanitizer   | negative_test_case   | source_and_sink   |
|------------|---------------------------|-------------------|----------------------|-------------------|
| D3         | FEATURE                   | no                | no                   | no                |

<details markdown="1">
<summary>
<b>More</b></summary>

<details markdown="1">
<summary>

### Compile
</summary>

```bash
$_main:
     ; (lines=16, args=0, vars=4, tmps=13)
     ; (before optimizer)
     ; /.../PHP/81_new_from_variable/3_instance_81_new_from_variable/3_instance_81_new_from_variable.php:1-13
     ; return  [] RANGE[0..0]
0000 T4 = FETCH_R (global) string("_GET")
0001 T5 = FETCH_DIM_R T4 string("p1")
0002 ASSIGN CV0($b) T5
0003 T7 = FETCH_R (global) string("_GET")
0004 T8 = FETCH_DIM_R T7 string("p2")
0005 ASSIGN CV1($bb) T8
0006 T10 = CONCAT string("class") CV1($bb)
0007 ASSIGN CV2($t) T10
0008 V12 = FETCH_CLASS (exception) CV2($t)
0009 V13 = NEW 1 V12
0010 SEND_VAR_EX CV0($b) 1
0011 DO_FCALL
0012 ASSIGN CV3($obj) V13
0013 T16 = FETCH_OBJ_R CV3($obj) string("x")
0014 ECHO T16
0015 RETURN int(1)
LIVE RANGES:
     13: 0010 - 0012 (new)

class1::__construct:
     ; (lines=4, args=1, vars=1, tmps=1)
     ; (before optimizer)
     ; /.../PHP/81_new_from_variable/3_instance_81_new_from_variable/3_instance_81_new_from_variable.php:4-6
     ; return  [] RANGE[0..0]
0000 CV0($y) = RECV 1
0001 ASSIGN_OBJ THIS string("x")
0002 OP_DATA CV0($y)
0003 RETURN null
```

</details>

<details markdown="1">
<summary>

### Discovery
</summary>

```scala
val G4 = cpg.call("ASSIGN").reachableByFlows(cpg.call("CONCAT").code(".*CONCAT.*string.*")).map(_.elements.last).collect{ case c : nodes.Call => c}.argument.order(0).isIdentifier.name.l.distinct
def R5 = cpg.call("FETCH_CLASS").code(".*CV.*").l
val x81 = (name, "81_new_from_variable_i3", R5.filter{ call => G4.exists{ h => call.argument.order(1).code.l.contains("CV($" + h + ")")} }.location.toJson);
```

| discovery method   | expected accuracy   |
|--------------------|---------------------|
| joern              | Perfect             |

</details>

<details markdown="1"open>
<summary>

### Measurement
</summary>

| Tool        | Comm_1   | Comm_2   | phpSAFE   | Progpilot   | RIPS   | WAP   | Ground Truth   |
|-------------|----------|----------|-----------|-------------|--------|-------|----------------|
| 08 Jun 2021 | no       | no       | no        | no          | no     | no    | yes            |
| 22 May 2023 | no       | yes      |           |             |        |       | yes            |

</details>

</details>

</details>
