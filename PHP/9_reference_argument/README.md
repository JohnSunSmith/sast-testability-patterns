[//]: # (This file is automatically generated. If you wish to make any changes, please use the JSON files and regenerate this file using the tpframework.)

# Reference Argument

Tags: sast, php, php_v7.4.9

Version: v1.0

## Description

PHP enables the passage of arguments to functions by reference, which permits modification of their values within the function. This feature presents a challenge for SAST tools, which must monitor all changes made to the input in the function. Moreover, whenever the input is assigned to another variable, the tool must capture any changes made to both variables.

## Overview

| Instances                 | has discovery rule   | discovery method   | rule successfull   |
|---------------------------|----------------------|--------------------|--------------------|
| [1 Instance](#1-instance) | yes                  | joern              | yes                |

## 1 Instance

This instance should target arguments passed by reference to a function.

### Code

```PHP
<?php
function foo(&$var,$input) { // tarpit
    $var = $input;
}

$a = $_GET["p1"]; // source
// foo will copy the $a in $b
foo($b,$a);
// XSS, will print the source
echo $b; // sink
```

### Instance Properties

| category   | feature_vs_internal_api   | input_sanitizer   | negative_test_case   | source_and_sink   |
|------------|---------------------------|-------------------|----------------------|-------------------|
| S0         | FEATURE                   | no                | no                   | no                |

<details markdown="1">
<summary>
<b>More</b></summary>

<details markdown="1">
<summary>

### Compile
</summary>

```bash
$_main:
     ; (lines=9, args=0, vars=2, tmps=4)
     ; (before optimizer)
     ; /.../PHP/9_reference_argument/1_instance_9_reference_argument/1_instance_9_reference_argument.php:1-10
     ; return  [] RANGE[0..0]
0000 T2 = FETCH_R (global) string("_GET")
0001 T3 = FETCH_DIM_R T2 string("p1")
0002 ASSIGN CV0($a) T3
0003 INIT_FCALL 2 128 string("foo")
0004 SEND_REF CV1($b) 1
0005 SEND_VAR CV0($a) 2
0006 DO_UCALL
0007 ECHO CV1($b)
0008 RETURN int(1)

foo:
     ; (lines=4, args=2, vars=2, tmps=1)
     ; (before optimizer)
     ; /.../PHP/9_reference_argument/1_instance_9_reference_argument/1_instance_9_reference_argument.php:2-4
     ; return  [] RANGE[0..0]
0000 CV0($var) = RECV 1
0001 CV1($input) = RECV 2
0002 ASSIGN CV0($var) CV1($input)
0003 RETURN null
```

</details>

<details markdown="1">
<summary>

### Discovery
</summary>

This rule searches fo `SEND_REF` in the opcode, which is the opcode equivalent for passing values by reference to a function. Therefot the rule should be Perfect.

```scala
val x9 = (name, "9_reference_argument_iall", cpg.call(".*SEND_REF.*").location.toJson);
```

| discovery method   | expected accuracy   |
|--------------------|---------------------|
| joern              | Perfect             |

</details>

<details markdown="1"open>
<summary>

### Measurement
</summary>

| Tool        | Comm_1   | Comm_2   | phpSAFE   | Progpilot   | RIPS   | WAP   | Ground Truth   |
|-------------|----------|----------|-----------|-------------|--------|-------|----------------|
| 08 Jun 2021 | yes      | yes      | no        | no          | no     | no    | yes            |
| 17 May 2023 | yes      | yes      |           |             |        |       | yes            |

</details>

<details markdown="1">
<summary>

### Remediation
</summary>

If possible, one could avoid passing the values by reference, instead, one could explicitly return those values from the function, so that the function has no side effects on the input values.

</details>

</details>
